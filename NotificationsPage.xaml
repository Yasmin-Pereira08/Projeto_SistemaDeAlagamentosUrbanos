<Page x:Class="TCC.NotificationsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="clr-namespace:TCC"
      Title="NotificationsPage">

    <Page.Resources>
        <local:RiskToBrushConverter x:Key="RiskToBrushConverter"/>

        <Style x:Key="RoundedButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#2563EB"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="10,4"/>
            <Setter Property="MinWidth" Value="100"/>
            <Setter Property="MinHeight" Value="35"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="8"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Estilo para a barra de pesquisa -->
        <Style x:Key="SearchBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="#1A2D5F"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#FFD98F00"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="8"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <ScrollViewer x:Name="PART_ContentHost" Margin="{TemplateBinding Padding}"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Template para o botão do ComboBox -->
        <ControlTemplate x:Key="ComboBoxToggleButtonTemplate" TargetType="ToggleButton">
            <Border x:Name="Border" 
                    Background="{TemplateBinding Background}"
                    BorderBrush="{TemplateBinding BorderBrush}"
                    BorderThickness="{TemplateBinding BorderThickness}"
                    CornerRadius="8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition />
                        <ColumnDefinition Width="32" />
                    </Grid.ColumnDefinitions>
                    <Border Grid.Column="0" 
                            Background="Transparent" 
                            CornerRadius="8,0,0,8"/>
                    <Path x:Name="Arrow"
                          Grid.Column="1"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"
                          Data="M0,0 L8,0 L4,4 Z"
                          Fill="#FFD98F00"/>
                </Grid>
            </Border>
            <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="true">
                    <Setter TargetName="Border" Property="Background" Value="#2A3D6F"/>
                </Trigger>
                <Trigger Property="IsChecked" Value="true">
                    <Setter TargetName="Arrow" Property="Data" Value="M0,4 L8,4 L4,0 Z"/>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>

        <!-- Estilo aprimorado para o ComboBox -->
        <Style x:Key="FilterComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Background" Value="#1A2D5F"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#FFD98F00"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="MinWidth" Value="150"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <ToggleButton x:Name="ToggleButton" 
                                          ClickMode="Press"
                                          Focusable="false"
                                          IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                          Template="{StaticResource ComboBoxToggleButtonTemplate}"
                                          Background="{TemplateBinding Background}"
                                          BorderBrush="{TemplateBinding BorderBrush}"
                                          BorderThickness="{TemplateBinding BorderThickness}"/>

                            <ContentPresenter x:Name="ContentPresenter"
                                              Content="{TemplateBinding SelectionBoxItem}"
                                              ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                              ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                              HorizontalAlignment="Left"
                                              IsHitTestVisible="False"
                                              Margin="12,8,0,8"
                                              VerticalAlignment="Center"/>

                            <Popup x:Name="PART_Popup"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   IsOpen="{Binding IsDropDownOpen, RelativeSource={RelativeSource TemplatedParent}}"
                                   PopupAnimation="Slide"
                                   Placement="Bottom">
                                <Border x:Name="DropDownBorder"
                                        Background="#1A2D5F"
                                        BorderBrush="#FFD98F00"
                                        BorderThickness="1"
                                        CornerRadius="8"
                                        Margin="0,2,0,0">
                                    <Border.Effect>
                                        <DropShadowEffect ShadowDepth="2" Direction="270" Color="Black" Opacity="0.4" BlurRadius="6"/>
                                    </Border.Effect>
                                    <ScrollViewer MaxHeight="{TemplateBinding MaxDropDownHeight}" SnapsToDevicePixels="True">
                                        <ItemsPresenter KeyboardNavigation.DirectionalNavigation="Contained"/>
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="HasItems" Value="false">
                                <Setter TargetName="DropDownBorder" Property="MinHeight" Value="95"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="ItemContainerStyle">
                <Setter.Value>
                    <Style TargetType="ComboBoxItem">
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="Foreground" Value="White"/>
                        <Setter Property="Padding" Value="10,8"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ComboBoxItem">
                                    <Border x:Name="Border"
                                            Background="{TemplateBinding Background}"
                                            BorderThickness="0"
                                            Padding="{TemplateBinding Padding}"
                                            SnapsToDevicePixels="true">
                                        <ContentPresenter/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsHighlighted" Value="true">
                                            <Setter TargetName="Border" Property="Background" Value="#2A3D6F"/>
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="true">
                                            <Setter TargetName="Border" Property="Background" Value="#3A4D7F"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Cabeçalho fixo -->
        <Border Grid.Row="0" BorderBrush="#FFD98F00" BorderThickness="0,0,0,1" Padding="20,0,20,12">
            <Border.Background>
                <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                    <GradientStop Color="#FF13377F"/>
                    <GradientStop Color="#FF051D4D" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Border.Effect>
                <DropShadowEffect ShadowDepth="2" Direction="270" Color="Black" Opacity="0.4" BlurRadius="6"/>
            </Border.Effect>
        </Border>

        <!-- Conteúdo com Scroll -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <Grid>
                <Grid.Background>
                    <RadialGradientBrush>
                        <GradientStop Color="#FF13377F"/>
                        <GradientStop Color="#FF051D4D" Offset="1"/>
                    </RadialGradientBrush>
                </Grid.Background>

                <StackPanel Margin="40">
                    <!-- Título -->
                    <TextBlock Text="Notificações"
                               FontSize="30"
                               Foreground="#FFD98F00"
                               FontWeight="Bold"
                               Margin="0 0 0 30"
                               HorizontalAlignment="Center"/>

                    <!-- Barra de pesquisa e filtro -->
                    <Grid Margin="0 0 0 20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Barra de pesquisa -->
                        <TextBox Grid.Column="0" 
                                 x:Name="SearchBox" 
                                 Style="{StaticResource SearchBoxStyle}"
                                 Margin="0 0 10 0"
                                 TextChanged="SearchBox_TextChanged"
                                 KeyDown="SearchBox_KeyDown"
                                 />

                        <!-- Botão de pesquisa -->
                        <Button Grid.Column="1" 
                                Content="🔍 Buscar" 
                                Style="{StaticResource RoundedButtonStyle}"
                                Click="SearchButton_Click"
                                Margin="0 0 10 0"/>

                        <!-- Filtro de nível -->
                        <ComboBox Grid.Column="2" 
                                  x:Name="FilterComboBox" 
                                  Style="{StaticResource FilterComboBoxStyle}"
                                  SelectionChanged="FilterComboBox_SelectionChanged">
                            <ComboBoxItem Content="Todos os níveis" IsSelected="True"/>
                            <ComboBoxItem Content="Nível baixo"/>
                            <ComboBoxItem Content="Nível médio"/>
                            <ComboBoxItem Content="Nível alto"/>
                        </ComboBox>
                    </Grid>

                    <!-- Botões de simulação -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="0 0 0 30" >
                        <Button Content="Baixo"
                                Click="SimularBaixo_Click"
                                Style="{StaticResource RoundedButtonStyle}"
                                Background="#1E3A8A"/>
                        <Button Content="Médio"
                                Click="SimularMedio_Click"
                                Style="{StaticResource RoundedButtonStyle}"
                                Background="Gold"
                                Foreground="White" BorderBrush="{x:Null}"/>
                        <Button Content="Alto"
                                Click="SimularAlto_Click"
                                Style="{StaticResource RoundedButtonStyle}"
                                Background="Red"/>
                    </StackPanel>

                    <!-- Mensagem de nenhuma notificação encontrada -->
                    <TextBlock x:Name="NoNotificationsMessage"
                               Text="Sem notificações para este endereço"
                               FontSize="18"
                               Foreground="White"
                               HorizontalAlignment="Center"
                               Margin="0 220 0 20"
                               Visibility="Collapsed"/>

                    <!-- Lista de Notificações -->
                    <ItemsControl x:Name="NotificacoesItemsControl" ItemsSource="{Binding NotificacoesFiltradas}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border CornerRadius="16"
                                        Margin="0 0 0 20"
                                        Padding="20"
                                        Background="#FF13377F"
                                        BorderBrush="{Binding Nivel, Converter={StaticResource RiskToBrushConverter}}"
                                        BorderThickness="2">
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0 0 0 10" >
                                            <TextBlock Text="⚠️"
                                                       FontSize="24"
                                                       Foreground="{Binding Nivel, Converter={StaticResource RiskToBrushConverter}}"
                                                       VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding Mensagem}"
                                                       Foreground="White"
                                                       FontSize="20"
                                                       FontWeight="Bold"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <TextBlock Text="{Binding Detalhes}"
                                                   Foreground="#CBD5E1"
                                                   FontSize="14"
                                                   Margin="34 0 0 15"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Grid>
        </ScrollViewer>
    </Grid>
</Page>
